<?xml version="1.0"?>
<!--    说明 ： 更多信息请参考凭证接口设计文档和代码   -->
<DocSourceVoucher  Cached="False">
	<Modle Name="SA">
		<Runtimes>
			<Runtime Name="Ufida.T.SA.DTO"/>
			<Runtime Name="Ufida.T.UA.SA"/>
			<Runtime Name="Ufida.T.SM.FC"/>
		</Runtimes>
		<Voucher Code="SA04" Name="SaleDeliveryDTO" Title="销货单">
			<SimpleQuery Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />

					<Property Name="VoucherId" MapProperty="SaleDeliveryDTO.ID" Title="单据Id"/>
					<Property Name="VoucherDate" MapProperty="SaleDeliveryDTO.VoucherDate" Title="单据日期"/>
					<Property Name="VoucherCode" MapProperty="SaleDeliveryDTO.Code" Title="单据编号"/>
					<Property Name="VoucherTs" MapProperty="SaleDeliveryDTO.TS" Title="单据时间戳"/>
					<Property Name="Idproject" MapProperty="SaleDeliveryDTO.Idproject" Title="项目"/>
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleDeliveryDTO.IdSettleCustomer" Title="客户"/>
					<Property Name="Iddepartment" MapProperty="SaleDeliveryDTO.Iddepartment" Title="部门"/>
					<Property Name="IdoutRdStyle" MapProperty="SaleDeliveryDTO.IdrdStyle" Title="出库类别"/>
					<Property Name="Idclerck" MapProperty="SaleDeliveryDTO.Idclerk" Title="业务员"/>
					<Property Name="IdbusiType" MapProperty="SaleDeliveryDTO.IdbusinessType" Title="业务类型"/>
					<Property Name="Idcurrency" MapProperty="SaleDeliveryDTO.Idcurrency" Title="币种"/>

					<Property Name="OrigAmount" MapProperty="SaleDeliveryDTO.OrigTaxAmount" Title="金额"/>
					<Property Name="Amount" MapProperty="SaleDeliveryDTO.TaxAmount" Title="本币金额"/>

				</Fields>

				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleDeliveryDTO.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleDeliveryDTO.Code" Title="单据编号"/>
					<Filter Name="CustomerCode" MapProperty="SaleDeliveryDTO.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleDeliveryDTO.SettleCustomer.IdpartnerClass" Title="客户分类"/>
					<Filter Name="InventoryCode" MapProperty="SaleDeliveryDTO.SaleDeliveryDetails.Inventory.Code" Title="存货"/>
					<Filter Name="OutRdStyles" MapProperty="SaleDeliveryDTO.IdrdStyle" Title="出库类别"/>
					<Filter Name="InventoryClasss" MapProperty="SaleDeliveryDTO.SaleDeliveryDetails.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="ProjectClass" MapProperty="SaleDeliveryDTO.SaleDeliveryDetails.Project.IdClass" Title="项目分类"/>
					<Filter Name="Departments" MapProperty="SaleDeliveryDTO.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleDeliveryDTO.Idclerk" Title="员工"/>
					<Filter Name="Warehouses" MapProperty="SaleDeliveryDTO.SaleDeliveryDetails.Idwarehouse" Title="仓库"/>
					<Filter Name="Projects" MapProperty="SaleDeliveryDTO.SaleDeliveryDetails.Idproject" Title="项目"/>
					<Filter Name="Currencys" MapProperty="SaleDeliveryDTO.Idcurrency" Title="币种"/>
					<Filter Name="Bankaccounts" MapProperty="SaleDeliveryDTO.SaleDeliverySettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleDeliveryDTO.SaleDeliverySettlements.IdsettleStyle" Title="结算方式"/>

					<Filter Name="OrigAmount" MapProperty="SaleDeliveryDTO.OrigTaxAmount" Title="金额"/>
					<Filter Name="Amount" MapProperty="SaleDeliveryDTO.TaxAmount" Title="本币金额"/>
					<Filter Name="maker" MapProperty="SaleDeliveryDTO.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleDeliveryDTO.auditorid"  Title="审核人"/>

				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="未生效的不生成">
						SaleDeliveryDTO.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="已生成凭证的业务单据不生成">
						SaleDeliveryDTO.DocId IS NULL
					</Filter>
					<Filter Name="若本账套已期间结转，不能筛选出账套结转期间之后的单据生成凭证">
						1=1
					</Filter>
					<Filter Name="该模块启用期间之前的期初单据不生成">
						SaleDeliveryDTO.VoucherDate>{ModelOpeningDate}
					</Filter>
					<Filter Name="明细有未记账的单据不生成">
						not exists
						(
						select voucherIDFlowUnite
						from ST_SubsidiaryBook
						where idvouchertypeflowunite='5794D3DD-7FE4-4B5C-AF53-D21DDC13BF16' and isTrueAccount = 0 and SaleDeliveryDTO.ID = voucherIDFlowUnite
						)
					</Filter>
					<Filter Name="销货单记账">
						(select value from EAP_AccInformation where Name='SAAccount') = 0
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleDeliveryDTO.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					Exists
					(
					select SaleDeliveryDetail.id from sa_SaleDelivery_b SaleDeliveryDetail where SaleDeliveryDetail.idSaleDeliveryDTO=SaleDeliveryDTO.id and abs(SaleDeliveryDetail.origDiscountAmount)>0
					)
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuery_SaleDelivery">
				<Header>
					<Property Name="SaleDeliveryDTO.ID"  Title="单据ID"/>
					<Property Name="SaleDeliveryDTO.TS"  Title="TS"/>
					<Property Name="SaleDeliveryDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleDeliveryDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.IdRdStyle"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.ID"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Name"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Code"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleDeliveryDTO.Code"  Title="单据编号"/>
					<Property Name="SaleDeliveryDTO.Memo"  Title="备注"/>
					<Property Name="SaleDeliveryDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleDeliveryDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<Property Name="SaleDeliveryDTO.OrigPreReceiveAmount"  Title="使用预收金额合计"/>
					<Property Name="SaleDeliveryDTO.OrigTaxAmount"  Title="明细含税金额合计"/>
					<Property Name="SaleDeliveryDTO.idCurrency"  Title="币种ID"/>
					<Property Name="SaleDeliveryDTO.Currency.ID"  Title="币种"/>
					<Property Name="SaleDeliveryDTO.Currency.Name"  Title="币种名称"/>
					<Property Name="SaleDeliveryDTO.ExchangeRate"  Title="汇率"/>
					<Property Name="SaleDeliveryDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleDeliveryDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleDeliveryDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleDeliveryDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleDeliveryDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleDeliveryDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleDeliveryDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleDeliveryDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleDeliveryDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleDeliveryDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleDeliveryDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleDeliverySettlements" DTO="SaleDeliverySettlementDTO" FK="idsaleDeliveryDTO" Title="现结明细">
						<Property Name="SaleDeliverySettlementDTO.ID"  Title="ID"/>
						<Property Name="SaleDeliverySettlementDTO.TS"  Title="TS"/>
						<Property Name="SaleDeliverySettlementDTO.idSettleStyle"  Title="结算方式id"/>
						<Property Name="SaleDeliverySettlementDTO.SettleStyle.ID"  Title="结算方式"/>
						<Property Name="SaleDeliverySettlementDTO.idBankAccount"  Title="账号id"/>
						<Property Name="SaleDeliverySettlementDTO.BankAccount.ID"  Title="账号"/>
						<Property Name="SaleDeliverySettlementDTO.BankAccount.BankNoType.ID"  Title="账号类型id"/>
						<Property Name="SaleDeliverySettlementDTO.BankAccount.Idcurrency"  Title="账号币种id"/>
						<Property Name="SaleDeliverySettlementDTO.BillNo"  Title="票据号"/>
						<Property Name="SaleDeliverySettlementDTO.Amount"  Title="收款金额本币"/>
						<Property Name="SaleDeliverySettlementDTO.OrigAmount"  Title="收款金额"/>
					</Detail>
					<Detail DetailRuleName="SaleDeliveryDetails" DTO="SaleDeliveryDetailDTO" FK="IdSaleDeliveryDTO" Title="单据明细">
						<Property Name="SaleDeliveryDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleDeliveryDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleDeliveryDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.OrigTaxAmount"  Title="原币含税金额"/>
						<Property Name="SaleDeliveryDetailDTO.TaxAmount"  Title="本币含税金额"/>
						<Property Name="SaleDeliveryDetailDTO.OrigDiscountAmount"  Title="原币金额"/>
						<Property Name="SaleDeliveryDetailDTO.OrigDiscountPrice"  Title="原币单价"/>
						<Property Name="SaleDeliveryDetailDTO.DiscountAmount"  Title="本币金额"/>
						<Property Name="SaleDeliveryDetailDTO.OrigSettleAmount"  Title="本币累计结算金额"/>
						<Property Name="SaleDeliveryDetailDTO.SettleAmount"  Title="原币累计结算金额"/>
						<Property Name="SaleDeliveryDetailDTO.OrigTax"  Title="原币税额"/>
						<Property Name="SaleDeliveryDetailDTO.Tax"  Title="本币税额"/>
						<Property Name="SaleDeliveryDetailDTO.BaseQuantity"  Title="主计量数量"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGenSaleDelivery">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromAr" Name="应收账款" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="OrigTaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="Ar">
							<ExtendRuleProperty Name="idpartnerclass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdPartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="idpartner" SourceVoucherProperty="SaleDelivery.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							
							<ExtendRuleProperty Name="Iddistrict" SourceVoucherProperty="SaleDelivery.SettleCustomer.Iddistrict" Title="地区"/>
							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="SaleDelivery.Idcurrency" Title="币种"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="IdoutRdStyle" SourceVoucher="SaleDelivery.IdRdStyle"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdsettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<TransactionEntry Code="DebitFromCashOrBank" Name="现金、银行存款" DCDirection="Debit">
					<Entry>
						<Property Doc="OrigAmountDr" SourceVoucher="OrigAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="Amount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigAmount" Title="外币"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<Property Doc="BillNo" SourceVoucher="BillNo" Title="票据号"/>
						<Account AccountRuleType="Cash">
							<!--现金-->
							<ExtendRuleProperty Name="IdbankAccount" SourceVoucherProperty="IdbankAccount"/>
							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="SaleDelivery.Idcurrency"/>

							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
						<Account AccountRuleType="Bank">
							<!--银行存款-->
							<ExtendRuleProperty Name="IdbankAccount" SourceVoucherProperty="IdbankAccount"/>
							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="SaleDelivery.Idcurrency"/>

							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="IdoutRdStyle" SourceVoucher="SaleDelivery.IdRdStyle"/>
						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdsettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="SaleDelivery.SaleDeliveryDetails.Idwarehouse"/>
						<Property Doc="IdsettleStyle" SourceVoucher="IdsettleStyle"/>
						<Property Doc="idBankAccount" SourceVoucher="IdbankAccount"/>
						<Property Doc="InvoiceCode" SourceVoucher="BillNo"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromSales" Name="主营业务收入" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="OrigDiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<Account AccountRuleType="Sales">
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="Idwarehouse" SourceVoucherProperty="Idwarehouse" Title="仓库"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdPartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleDelivery.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="IdoutRdStyle" SourceVoucher="SaleDelivery.IdRdStyle"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdsettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
						<Property Doc="Quantity" SourceVoucher="BaseQuantity" Title="数量"/>
						<Property Doc="Price" SourceVoucher="OrigDiscountPrice" Title="单价"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<TransactionEntry Code="DebitFromSalesTax" Name="应交税金（销）"  DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="OrigTax" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="Tax" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTax" Title="外币"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<Account AccountRuleType="SalesTax">  

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>

							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdpartnerClass" Title="客户"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleDelivery.IdsettleCustomer" Title="客户分类"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>

							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="IdoutRdStyle" SourceVoucher="SaleDelivery.IdRdStyle"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdsettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<TransactionEntry Code="DebitFromAdv" Name="现结+使用预收>明细含税金额合计" DCDirection="Credit">
					<Entry>
						<Property Doc="Idcurrency" SourceVoucher="Idcurrency"/>
						<Property Doc="ExchangeRate" SourceVoucher="ExchangeRate"/>
						<Property Doc="Memoto" SourceVoucher="Memo"/>
						<Account AccountRuleType="AdvReceive">
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SettleCustomer.IdpartnerClass"/>
							<ExtendRuleProperty Name="idbusiType" SourceVoucherProperty="idbusiType"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="IdSettleCustomer"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Iddistrict" SourceVoucherProperty="SettleCustomer.Iddistrict"/>
							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="Idcurrency"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject"/>
							<ExtendRuleProperty Name="IdProjectClass" SourceVoucherProperty="Project.idclass"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="pubuserdefnvc5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="pubuserdefnvc6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="pubuserdefdecm5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="pubuserdefdecm6"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc0" SourceVoucherProperty="priuserdefnvc1"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc1" SourceVoucherProperty="priuserdefnvc2"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc2" SourceVoucherProperty="priuserdefnvc3"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc3" SourceVoucherProperty="priuserdefnvc4"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc4" SourceVoucherProperty="priuserdefnvc5"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc5" SourceVoucherProperty="priuserdefnvc6"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm0" SourceVoucherProperty="priuserdefdecm1"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm1" SourceVoucherProperty="priuserdefdecm2"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm2" SourceVoucherProperty="priuserdefdecm3"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm3" SourceVoucherProperty="priuserdefdecm4"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm4" SourceVoucherProperty="priuserdefdecm5"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm5" SourceVoucherProperty="priuserdefdecm6"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdbankAccount" SourceVoucher="IdbankAccount"/>
						<Property Doc="Idcustomer" SourceVoucher="IdSettleCustomer"/>
						<Property Doc="IdcustomerClass" SourceVoucher="SettleCustomer.IdpartnerClass"/>
						<Property Doc="Iddistrict" SourceVoucher="SettleCustomer.Iddistrict"/>
						<Property Doc="Iddepartment" SourceVoucher="Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="Idperson"/>
						<Property Doc="Idcurrency" SourceVoucher="Idcurrency"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="idbusiType" SourceVoucher="IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="Code"/>
						<Property Doc="VoucherDate" SourceVoucher="VoucherDate"/>
						<Property Doc="IdVoucherType" SourceVoucher="{IdvoucherType}"/>
						<Property Doc="IdIncome" SourceVoucher=""/>
						<Property Doc="IdExpenseItem" SourceVoucher=""/>
						<Property Doc="IdWarehouse" SourceVoucher=""/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdDocumentsUsageDTO" SourceVoucher=""/>
						<Property Doc="IdInRdStyle" SourceVoucher=""/>
						<!--<Property Doc="IdSettleStyle" SourceVoucher="IdsettleStyle"/>-->
						<!--<Property Doc="IdDistrict" SourceVoucher="Partner.iddistrict"/>-->
						<!--<Property Doc="IdBankAccount" SourceVoucher="IdbankAccount"/>-->
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBackSaleDelivery" />
		</Voucher>
		<Voucher Code="sd_SaleDeliveryFromSaleDispatch" Name="SaleDeliveryDTO" Title="先出库后销货的销货单确认成本" IsClosingAccountCarryForward="true">
			<SimpleQuery Name="SaleDeliveryDetailDTO" Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleDelivery.IdSettleCustomer" Title="客户"/>
					<Property Name="VoucherId" MapProperty="SaleDelivery.ID" Title="单据Id"/>
					<Property Name="VoucherTs" MapProperty="SaleDelivery.TS" Title="单据时间戳"/>
					<Property Name="VoucherDetailId" MapProperty="SaleDeliveryDetailDTO.ID" Title="明细Id"/>
					<Property Name="VoucherDetailTs" MapProperty="SaleDeliveryDetailDTO.TS" Title="明细时间戳"/>
					<Property Name="Iddepartment" MapProperty="SaleDelivery.Iddepartment" Title="部门"/>
					<Property Name="Idclerck" MapProperty="SaleDelivery.Idclerk" Title="业务员"/>
					<Property Name="Idproject" MapProperty="SaleDeliveryDetailDTO.Idproject" Title="项目"/>
					<Property Name="IdinventoryClass" MapProperty="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Property Name="Idinventory" MapProperty="SaleDeliveryDetailDTO.IdInventory" Title="存货"/>
					<Property Name="IdbaesUnit" MapProperty="SaleDeliveryDetailDTO.IdbaseUnit" Title="主计量"/>
					<Property Name="VoucherDate" MapProperty="SaleDelivery.VoucherDate" Title="发票日期"/>
					<Property Name="VoucherCode" MapProperty="SaleDelivery.Code" Title="发票号"/>
					<Property Name="ExecutedQuantity" MapProperty="BaseQuantity" Title="数量"/>
					<Property Name="CostPrice" MapProperty="SaleDeliveryDetailDTO.CostPrice" Title="成本单价"/>
					<Property Name="CostAmount" MapProperty="SaleDeliveryDetailDTO.CostAmount" Title="成本金额"/>
				</Fields>
				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleDelivery.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleDelivery.Code" Title="单据编号"/>
					<Filter Name="Departments" MapProperty="SaleDelivery.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleDelivery.Idclerk" Title="员工"/>
					<Filter Name="CustomerCode" MapProperty="SaleDelivery.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleDelivery.SettleCustomer.idPartnerClass" Title="客户分类"/>
					<Filter Name="Projects" MapProperty="SaleDeliveryDetailDTO.Idproject" Title="项目"/>
					<Filter Name="ProjectClass" MapProperty="SaleDeliveryDetailDTO.Project.IdClass" Title="项目分类"/>
					<Filter Name="InventoryCode" MapProperty="SaleDeliveryDetailDTO.Inventory.Code" Title="存货"/>
					<Filter Name="InventoryClasss" MapProperty="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="Bankaccounts" MapProperty="SaleDelivery.SaleDeliverySettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleDelivery.SaleDeliverySettlements.IdsettleStyle" Title="结算方式"/>

					<Filter Name="CostPrice" MapProperty="SaleDeliveryDetailDTO.CostPrice" Title="成本单价"/>
					<Filter Name="CostAmount" MapProperty="SaleDeliveryDetailDTO.CostAmount" Title="成本金额"/>
					<Filter Name="maker" MapProperty="SaleDelivery.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleDelivery.auditorid"  Title="审核人"/>
				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="来源于以前期间销售出库单的销货单">
						(
						Exists(
						select sa_saledelivery_b.id
						from sa_saledelivery_b
						inner join  st_rdrecord on sa_saledelivery_b.sourcevoucherid=st_rdrecord.id
						inner join sa_saledelivery on sa_saledelivery_b.idsaledeliverydto=sa_saledelivery.id
						left join GL_Doc on st_rdrecord.docid =GL_Doc.id
						where SaleDeliveryDetailDTO.id=sa_saledelivery_b.id
						and st_rdrecord.docid is not null
						and sa_saledelivery.CreatedTime > GL_Doc.createdtime
						and st_rdrecord.voucherdate between {StartPeriod} and {EndPeriod}
						)
						or Exists(
						select id from st_rdrecord where SaleDeliveryDetailDTO.sourceVoucherId=id and st_rdrecord.voucherdate&lt;{StartPeriod} --来源于以前期间销售出库单的销货单
						)
						)
					</Filter>
					<Filter Name="没有期末成本结转过">
						SaleDeliveryDetailDTO.docid is null
					</Filter>
					<Filter Name="来源是销售出库单">
						SaleDeliveryDetailDTO.IdsourceVoucherType='BB007F33-C0F0-4A19-8588-1E0E314D1F56'
					</Filter>
					<Filter Name="未生效的不生成">
						SaleDelivery.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="存货属性=劳务的不生成">
						SaleDeliveryDetailDTO.Inventory.IsLaborCost=0
					</Filter>
					<Filter Name="当前期间内的单据">
						SaleDelivery.voucherdate between {StartPeriod} and {EndPeriod}
					</Filter>
					<Filter Name="选项“未销货的销售出库单”为“处理为发出商品”">
						(select value from EAP_AccInformation where Name='NoSaledDispatchVoucher')=1
					</Filter>
					<Filter Name="分开流程”">
						(select value from EAP_AccInformation where name='SAWorkflow')=1
					</Filter>
					<Filter Name="销货单记账">
						(select value from EAP_AccInformation where Name='SAAccount') = 0
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleDelivery.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					abs(isnull(SaleDeliveryDetailDTO.CostPrice,0))>0 and Exists(select id from st_rdrecord_b where SaleDeliveryDetailDTO.sourceVoucherDetailId=st_rdrecord_b.id and abs(isnull(st_rdrecord_b.Price,0))>0)
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuerysd_SaleDeliveryFromSaleDispatch">
				<Header>
					<Property Name="SaleDeliveryDTO.ID"  Title="单据ID"/>
					<Property Name="SaleDeliveryDTO.TS"  Title="TS"/>
					<Property Name="SaleDeliveryDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleDeliveryDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.IdRdStyle"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.ID"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Name"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Code"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleDeliveryDTO.Code"  Title="单据编号"/>
					<Property Name="SaleDeliveryDTO.Memo"  Title="备注"/>
					<Property Name="SaleDeliveryDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleDeliveryDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<!--<Property Name="SaleDeliveryDTO.idCurrency"  Title="币种ID"/>
          <Property Name="SaleDeliveryDTO.Currency.ID"  Title="币种"/>
          <Property Name="SaleDeliveryDTO.Currency.Name"  Title="币种名称"/>
          <Property Name="SaleDeliveryDTO.ExchangeRate"  Title="汇率"/>-->
					<Property Name="SaleDeliveryDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleDeliveryDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleDeliveryDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleDeliveryDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleDeliveryDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleDeliveryDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleDeliveryDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleDeliveryDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleDeliveryDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleDeliveryDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleDeliveryDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.IdSourceVoucherType"  Title="来源单据ID"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleDeliveryDetails" DTO="SaleDeliveryDetailDTO" FK="IdSaleDeliveryDTO" Title="单据明细">
						<Property Name="SaleDeliveryDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleDeliveryDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleDeliveryDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.SourceVoucherId"  Title="来源单据ID"/>
						<Property Name="SaleDeliveryDetailDTO.SourceVoucherDetailId"  Title="来源明细ID"/>
						<Property Name="SaleDeliveryDetailDTO.CostPrice"  Title="成本单价"/>
						<Property Name="SaleDeliveryDetailDTO.CostAmount"  Title="成本金额"/>
						<Property Name="SaleDeliveryDetailDTO.BaseQuantity"  Title="主计量数量"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGensd_SaleDeliveryFromSaleDispatch">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromInventoryPartner" Name="主营业务成本" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="TaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="InventoryPartner">
							<ExtendRuleProperty Name="IdvoucherType" SourceVoucherProperty="{IdSaleDispatchVoucherType}" Title="单据类型"/>
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleDelivery.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="adjusttype" SourceVoucherProperty="{NULL}" Title="调整类型"/>
							<ExtendRuleProperty Name="IdrdStyle" SourceVoucherProperty="SaleDelivery.IdrdStyle" Title="出库类别"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleDelivery.IdsettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromDeliveryInventory" Name="发出商品" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="DiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<Account AccountRuleType="DeliveryInventory">
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleDelivery.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleDelivery.IdsettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBacksd_SaleDeliveryFromSaleDispatch" />
		</Voucher>
		<Voucher Code="sd_CarryforwardVituralCost" Name="SaleDeliveryDTO" Title="先销货后出库的销货单虚拟结转成本" IsClosingAccountCarryForward="true">
			<SimpleQuery Name="SaleDeliveryDetailDTO" Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleDelivery.IdSettleCustomer" Title="客户"/>
					<Property Name="VoucherId" MapProperty="SaleDelivery.ID" Title="单据Id"/>
					<Property Name="VoucherTs" MapProperty="SaleDelivery.TS" Title="单据时间戳"/>
					<Property Name="VoucherDetailId" MapProperty="SaleDeliveryDetailDTO.ID" Title="明细Id"/>
					<Property Name="VoucherDetailTs" MapProperty="SaleDeliveryDetailDTO.TS" Title="明细时间戳"/>
					<Property Name="Iddepartment" MapProperty="SaleDelivery.Iddepartment" Title="部门"/>
					<Property Name="Idclerck" MapProperty="SaleDelivery.Idclerk" Title="业务员"/>
					<Property Name="Idproject" MapProperty="SaleDeliveryDetailDTO.Idproject" Title="项目"/>
					<Property Name="IdinventoryClass" MapProperty="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Property Name="Idinventory" MapProperty="SaleDeliveryDetailDTO.IdInventory" Title="存货"/>
					<Property Name="IdbaesUnit" MapProperty="SaleDeliveryDetailDTO.IdbaseUnit" Title="主计量"/>
					<Property Name="VoucherDate" MapProperty="SaleDelivery.VoucherDate" Title="发票日期"/>
					<Property Name="VoucherCode" MapProperty="SaleDelivery.Code" Title="发票号"/>
					<Property Name="ExecutedQuantity" MapProperty="SaleDeliveryDetailDTO.BaseQuantity" Title="数量"/>
					<Property Name="CostPrice" MapProperty="SaleDeliveryDetailDTO.CostPrice" Title="成本单价"/>
					<Property Name="CostAmount" MapProperty="SaleDeliveryDetailDTO.CostAmount" Title="成本金额"/>
				</Fields>
				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleDelivery.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleDelivery.Code" Title="单据编号"/>
					<Filter Name="Departments" MapProperty="SaleDelivery.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleDelivery.Idclerk" Title="员工"/>
					<Filter Name="CustomerCode" MapProperty="SaleDelivery.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleDelivery.SettleCustomer.idPartnerClass" Title="客户分类"/>
					<Filter Name="ProjectClass" MapProperty="SaleDeliveryDetailDTO.Project.IdClass" Title="项目分类"/>
					<Filter Name="Projects" MapProperty="SaleDeliveryDetailDTO.Idproject" Title="项目"/>
					<Filter Name="InventoryCode" MapProperty="SaleDeliveryDetailDTO.Inventory.Code" Title="存货"/>
					<Filter Name="InventoryClasss" MapProperty="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="Bankaccounts" MapProperty="SaleDelivery.SaleDeliverySettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleDelivery.SaleDeliverySettlements.IdsettleStyle" Title="结算方式"/>

					<Filter Name="CostPrice" MapProperty="SaleDeliveryDetailDTO.CostPrice" Title="成本单价"/>
					<Filter Name="CostAmount" MapProperty="SaleDeliveryDetailDTO.CostAmount" Title="成本金额"/>
					<Filter Name="maker" MapProperty="SaleDelivery.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleDelivery.auditorid"  Title="审核人"/>
				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="来源单据不是销售出库单，且在当期尚未出库完毕">
						Abs(SaleDeliveryDetailDTO.baseQuantity)>(
						--销货单---出库单
						(select  Abs(isnull(SUM(baseQuantity),0)) quantity from ST_RDRecord_b
						left join ST_RDRecord on ST_RDRecord.id=ST_RDRecord_b.idRDRecordDTO
						where 1=1
						and st_rdrecord.voucherdate between {StartPeriod} and {EndPeriod}
						and ST_RDRecord_b.sourceVoucherDetailId=SaleDeliveryDetailDTO.id)

						+

						--销货单---配送单---出库单
						(select Abs(isnull(SUM(baseQuantity),0)) quantity from ST_RDRecordSourceRelation
						left join ST_RDRecord on ST_RDRecord.id=ST_RDRecordSourceRelation.voucherid
						where 1=1
						and st_rdrecord.voucherdate between {StartPeriod} and {EndPeriod}
						and ST_RDRecordSourceRelation.sourceVoucherDetailId=SaleDeliveryDetailDTO.id
						AND ST_RDRecord.idsourcevouchertype ='3DC12E8A-9243-454A-ADAA-8DC8E1109031')
						)
					</Filter>
					<Filter Name="没有期末成本结转过">
						SaleDeliveryDetailDTO.docid is null
					</Filter>
					<Filter Name="来源不是销售出库单">
						(SaleDeliveryDetailDTO.IdsourceVoucherType is null or SaleDeliveryDetailDTO.IdsourceVoucherType &lt;> 'BB007F33-C0F0-4A19-8588-1E0E314D1F56' and SaleDeliveryDetailDTO.IdsourceVoucherType &lt;> 'EB475F0D-3379-4568-BB37-77877E830594')
					</Filter>
					<Filter Name="存货属性=劳务的不生成">
						SaleDeliveryDetailDTO.Inventory.IsLaborCost=0
					</Filter>
					<Filter Name="未生效的不生成">
						SaleDelivery.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="当前期间内的单据">
						SaleDelivery.voucherdate between {StartPeriod} and {EndPeriod}
					</Filter>
					<Filter Name="“未出库的销货单”的选项是“确认收入并结转成本”">
						(select value from EAP_AccInformation where Name='NoDispatchSaleDelivery')=1
					</Filter>
					<Filter Name="分开流程”">
						(select value from EAP_AccInformation where name='SAWorkflow')=1
					</Filter>
					<Filter Name="销货单记账">
						(select value from EAP_AccInformation where Name='SAAccount') = 0
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleDelivery.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					abs(isnull(SaleDeliveryDetailDTO.CostPrice,0))>0
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuerysd_CarryforwardVituralCost">
				<Header>
					<Property Name="SaleDeliveryDTO.ID"  Title="单据ID"/>
					<Property Name="SaleDeliveryDTO.TS"  Title="TS"/>
					<Property Name="SaleDeliveryDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleDeliveryDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.IdRdStyle"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.ID"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Name"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Code"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleDeliveryDTO.Code"  Title="单据编号"/>
					<Property Name="SaleDeliveryDTO.Memo"  Title="备注"/>
					<Property Name="SaleDeliveryDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleDeliveryDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<!--<Property Name="SaleDeliveryDTO.idCurrency"  Title="币种ID"/>
          <Property Name="SaleDeliveryDTO.Currency.ID"  Title="币种"/>
          <Property Name="SaleDeliveryDTO.Currency.Name"  Title="币种名称"/>
          <Property Name="SaleDeliveryDTO.ExchangeRate"  Title="汇率"/>-->
					<Property Name="SaleDeliveryDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleDeliveryDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleDeliveryDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleDeliveryDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleDeliveryDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleDeliveryDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleDeliveryDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleDeliveryDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleDeliveryDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleDeliveryDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleDeliveryDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.IdSourceVoucherType"  Title="来源单据ID"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleDeliveryDetails" DTO="SaleDeliveryDetailDTO" FK="IdSaleDeliveryDTO" Title="单据明细">
						<Property Name="SaleDeliveryDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleDeliveryDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleDeliveryDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.SourceVoucherId"  Title="来源单据ID"/>
						<Property Name="SaleDeliveryDetailDTO.SourceVoucherDetailId"  Title="来源明细ID"/>
						<Property Name="SaleDeliveryDetailDTO.CostPrice"  Title="成本单价"/>
						<Property Name="SaleDeliveryDetailDTO.CostAmount"  Title="成本金额"/>
						<Property Name="SaleDeliveryDetailDTO.BaseQuantity"  Title="主计量数量"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGensd_CarryforwardVituralCost">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromInventoryPartner" Name="主营业务成本" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="TaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="InventoryPartner">
							<ExtendRuleProperty Name="IdvoucherType" SourceVoucherProperty="{IdSaleDispatchVoucherType}" Title="单据类型"/>
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleDelivery.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="adjusttype" SourceVoucherProperty="{NULL}" Title="调整类型"/>
							<ExtendRuleProperty Name="IdrdStyle" SourceVoucherProperty="SaleDelivery.IdrdStyle" Title="出库类别"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdPartnerClass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="IdPartner" SourceVoucherProperty="SaleDelivery.IdsettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="Iddepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromDeliveryInventory" Name="发出商品" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="DiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<Account AccountRuleType="DeliveryInventory">
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleDelivery.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdPartnerClass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="IdPartner" SourceVoucherProperty="SaleDelivery.IdsettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBacksi_CarrryforwardVituralCost" />
		</Voucher>
		<Voucher Code="sd_MergeFlowCarryforwardCost" Name="SaleDeliveryDTO" Title="合并流程结转销售成本" IsClosingAccountCarryForward="true">
			<SimpleQuery Name="SaleDeliveryDetailDTO" Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleDelivery.IdSettleCustomer" Title="客户"/>
					<Property Name="VoucherId" MapProperty="SaleDelivery.ID" Title="单据Id"/>
					<Property Name="VoucherTs" MapProperty="SaleDelivery.TS" Title="单据时间戳"/>
					<Property Name="VoucherDetailId" MapProperty="SaleDeliveryDetailDTO.ID" Title="明细Id"/>
					<Property Name="VoucherDetailTs" MapProperty="SaleDeliveryDetailDTO.TS" Title="明细时间戳"/>
					<Property Name="Iddepartment" MapProperty="SaleDelivery.Iddepartment" Title="部门"/>
					<Property Name="Idclerck" MapProperty="SaleDelivery.Idclerk" Title="业务员"/>
					<Property Name="Idproject" MapProperty="SaleDeliveryDetailDTO.Idproject" Title="项目"/>
					<Property Name="IdinventoryClass" MapProperty="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Property Name="Idinventory" MapProperty="SaleDeliveryDetailDTO.IdInventory" Title="存货"/>
					<Property Name="IdbaesUnit" MapProperty="SaleDeliveryDetailDTO.IdbaseUnit" Title="主计量"/>
					<Property Name="VoucherDate" MapProperty="SaleDelivery.VoucherDate" Title="发票日期"/>
					<Property Name="VoucherCode" MapProperty="SaleDelivery.Code" Title="发票号"/>
					<Property Name="ExecutedQuantity" MapProperty="BaseQuantity" Title="数量"/>
					<Property Name="CostPrice" MapProperty="SaleDeliveryDetailDTO.CostPrice" Title="成本单价"/>
					<Property Name="CostAmount" MapProperty="SaleDeliveryDetailDTO.CostAmount" Title="成本金额"/>
				</Fields>
				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleDelivery.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleDelivery.Code" Title="单据编号"/>
					<Filter Name="Departments" MapProperty="SaleDelivery.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleDelivery.Idclerk" Title="员工"/>
					<Filter Name="CustomerCode" MapProperty="SaleDelivery.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleDelivery.SettleCustomer.idPartnerClass" Title="客户分类"/>
					<Filter Name="Projects" MapProperty="SaleDeliveryDetailDTO.Idproject" Title="项目"/>
					<Filter Name="InventoryCode" MapProperty="SaleDeliveryDetailDTO.Inventory.Code" Title="存货"/>
					<Filter Name="ProjectClass" MapProperty="SaleDeliveryDetailDTO.Project.IdClass" Title="项目分类"/>
					<Filter Name="InventoryClasss" MapProperty="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="Bankaccounts" MapProperty="SaleDelivery.SaleDeliverySettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleDelivery.SaleDeliverySettlements.IdsettleStyle" Title="结算方式"/>

					<Filter Name="CostPrice" MapProperty="SaleDeliveryDetailDTO.CostPrice" Title="成本单价"/>
					<Filter Name="CostAmount" MapProperty="SaleDeliveryDetailDTO.CostAmount" Title="成本金额"/>
					<Filter Name="maker" MapProperty="SaleDelivery.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleDelivery.auditorid"  Title="审核人"/>
				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="没有期末成本结转过">
						SaleDeliveryDetailDTO.docid is null
					</Filter>
					<Filter Name="未生效的不生成">
						SaleDelivery.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="当前期间内的单据">
						SaleDelivery.voucherdate between {StartPeriod} and {EndPeriod}
					</Filter>
					<!--<Filter Name="合并流程时，先销货后出库结转虚拟成本时，成本为0的总是不能生成凭证，总是不显示">
            SaleDeliveryDetailDTO.CostPrice>0
          </Filter>-->
					<Filter Name="存货属性=劳务的不生成">
						SaleDeliveryDetailDTO.Inventory.IsLaborCost=0
					</Filter>
					<Filter Name="销售合并流程">
						(select value from EAP_AccInformation where name='SAWorkflow')=0
					</Filter>
					<Filter Name="销货单记账">
						(select value from EAP_AccInformation where Name='SAAccount') = 0
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleDelivery.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					abs(isnull(SaleDeliveryDetailDTO.CostPrice,0))>0
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuerysi_CarrryforwardVituralCost">
				<Header>
					<Property Name="SaleDeliveryDTO.ID"  Title="单据ID"/>
					<Property Name="SaleDeliveryDTO.TS"  Title="TS"/>
					<Property Name="SaleDeliveryDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleDeliveryDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleDeliveryDTO.IdRdStyle"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.ID"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Name"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.RdStyle.Code"  Title="出库类别"/>
					<Property Name="SaleDeliveryDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleDeliveryDTO.Code"  Title="单据编号"/>
					<Property Name="SaleDeliveryDTO.Memo"  Title="备注"/>
					<Property Name="SaleDeliveryDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleDeliveryDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<Property Name="SaleDeliveryDTO.idCurrency"  Title="币种ID"/>
					<Property Name="SaleDeliveryDTO.Currency.ID"  Title="币种"/>
					<Property Name="SaleDeliveryDTO.Currency.Name"  Title="币种名称"/>
					<Property Name="SaleDeliveryDTO.ExchangeRate"  Title="汇率"/>
					<Property Name="SaleDeliveryDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleDeliveryDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleDeliveryDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleDeliveryDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleDeliveryDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleDeliveryDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleDeliveryDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleDeliveryDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleDeliveryDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleDeliveryDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleDeliveryDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleDeliveryDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleDeliveryDTO.IdSourceVoucherType"  Title="来源单据ID"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleDeliveryDetails" DTO="SaleDeliveryDetailDTO" FK="IdSaleDeliveryDTO" Title="单据明细">
						<Property Name="SaleDeliveryDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleDeliveryDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleDeliveryDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleDeliveryDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleDeliveryDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleDeliveryDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleDeliveryDetailDTO.SourceVoucherId"  Title="来源单据ID"/>
						<Property Name="SaleDeliveryDetailDTO.SourceVoucherDetailId"  Title="来源明细ID"/>
						<Property Name="SaleDeliveryDetailDTO.CostPrice"  Title="成本单价"/>
						<Property Name="SaleDeliveryDetailDTO.CostAmount"  Title="成本金额"/>
						<Property Name="SaleDeliveryDetailDTO.BaseQuantity"  Title="主计量数量"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGensd_MergeFlowCarryforwardCost">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromInventoryPartner" Name="主营业务成本" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="TaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="InventoryPartner">
							<ExtendRuleProperty Name="IdvoucherType" SourceVoucherProperty="{IdvoucherType}" Title="单据类型"/>
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleDelivery.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="adjusttype" SourceVoucherProperty="{NULL}" Title="调整类型"/>
							<ExtendRuleProperty Name="IdrdStyle" SourceVoucherProperty="SaleDelivery.IdrdStyle" Title="出库类别"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleDelivery.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleDelivery.IdsettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromInventory" Name="库存商品" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="DiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleDelivery.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleDelivery.Memo" Title="备注"/>
						<Account AccountRuleType="Inventory">
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="Idwarehouse" SourceVoucherProperty="Idwarehouse" Title="仓库"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleDelivery.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleDelivery.IdClerk"/>
							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleDelivery.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleDelivery.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleDelivery.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleDelivery.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleDelivery.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleDelivery.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleDelivery.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleDelivery.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleDelivery.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleDelivery.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleDelivery.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleDelivery.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleDelivery.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleDelivery.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleDelivery.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleDelivery.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleDelivery.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleDelivery.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleDelivery.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleDelivery.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleDelivery.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleDelivery.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleDelivery.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBacksd_MergeFlowCarryforwardCost" />
		</Voucher>

		<Voucher Code="SA05" Name="SaleInvoiceDTO" Title="销售发票">
			<SimpleQuery Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />

					<Property Name="VoucherId" MapProperty="SaleInvoiceDTO.ID" Title="单据Id"/>
					<Property Name="VoucherDate" MapProperty="SaleInvoiceDTO.VoucherDate" Title="单据日期"/>
					<Property Name="VoucherCode" MapProperty="SaleInvoiceDTO.Code" Title="单据编号"/>
					<Property Name="VoucherTs" MapProperty="SaleInvoiceDTO.TS" Title="单据时间戳"/>
					<Property Name="Idproject" MapProperty="SaleInvoiceDTO.Idproject" Title="项目"/>
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleInvoiceDTO.IdSettleCustomer" Title="客户"/>
					<Property Name="Iddepartment" MapProperty="SaleInvoiceDTO.Iddepartment" Title="部门"/>
					<Property Name="Idclerck" MapProperty="SaleInvoiceDTO.Idclerk" Title="业务员"/>
					<Property Name="IdbusiType" MapProperty="SaleInvoiceDTO.IdbusinessType" Title="业务类型"/>
					<Property Name="Idcurrency" MapProperty="SaleInvoiceDTO.Idcurrency" Title="币种"/>

					<Property Name="OrigAmount" MapProperty="SaleInvoiceDTO.OrigTaxAmount" Title="金额"/>
					<Property Name="Amount" MapProperty="SaleInvoiceDTO.TaxAmount" Title="本币金额"/>

				</Fields>

				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleInvoiceDTO.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleInvoiceDTO.Code" Title="单据编号"/>
					<Filter Name="CustomerCode" MapProperty="SaleInvoiceDTO.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleInvoiceDTO.SettleCustomer.IdpartnerClass" Title="客户分类"/>
					<Filter Name="InventoryCode" MapProperty="SaleInvoiceDTO.SaleInvoiceDetails.Inventory.Code" Title="存货"/>
					<Filter Name="InventoryClasss" MapProperty="SaleInvoiceDTO.SaleInvoiceDetails.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="Departments" MapProperty="SaleInvoiceDTO.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleInvoiceDTO.Idclerk" Title="员工"/>
					<Filter Name="Warehouses" MapProperty="SaleInvoiceDTO.SaleInvoiceDetails.Idwarehouse" Title="仓库"/>
					<Filter Name="ProjectClass" MapProperty="SaleInvoiceDTO.SaleInvoiceDetails.Project.IdClass" Title="项目分类"/>
					<Filter Name="Projects" MapProperty="SaleInvoiceDTO.SaleInvoiceDetails.Idproject" Title="项目"/>
					<Filter Name="Currencys" MapProperty="SaleInvoiceDTO.Idcurrency" Title="币种"/>
					<Filter Name="Bankaccounts" MapProperty="SaleInvoiceDTO.SaleInvoiceSettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleInvoiceDTO.SaleInvoiceSettlements.IdsettleStyle" Title="结算方式"/>

					<Filter Name="OrigAmount" MapProperty="SaleInvoiceDTO.OrigTaxAmount" Title="金额"/>
					<Filter Name="Amount" MapProperty="SaleInvoiceDTO.TaxAmount" Title="本币金额"/>
					<Filter Name="maker" MapProperty="SaleInvoiceDTO.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleInvoiceDTO.auditorid"  Title="审核人"/>
				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="未生效的不生成">
						SaleInvoiceDTO.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="已生成凭证的业务单据不生成">
						SaleInvoiceDTO.DocId IS NULL
					</Filter>
					<Filter Name="若本账套已期间结转，不能筛选出账套结转期间之后的单据生成凭证">
						1=1
					</Filter>
					<Filter Name="该模块启用期间之前的期初单据不生成">
						SaleInvoiceDTO.VoucherDate>{ModelOpeningDate}
					</Filter>
					<Filter Name="发票立账">
						(select value from EAP_AccInformation where Name='SAAccount') = 1
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleInvoiceDTO.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					Exists
					(
					select SaleInvoiceDetail.id from sa_SaleInvoice_b SaleInvoiceDetail where SaleInvoiceDetail.idSaleInvoiceDTO=SaleInvoiceDTO.id and abs(SaleInvoiceDetail.origDiscountAmount)>0
					)
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuery_SaleInvoice">
				<Header>
					<Property Name="SaleInvoiceDTO.ID"  Title="单据ID"/>
					<Property Name="SaleInvoiceDTO.TS"  Title="TS"/>
					<Property Name="SaleInvoiceDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleInvoiceDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleInvoiceDTO.Code"  Title="单据编号"/>
					<Property Name="SaleInvoiceDTO.Memo"  Title="备注"/>
					<Property Name="SaleInvoiceDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleInvoiceDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<Property Name="SaleInvoiceDTO.OrigPreReceiveAmount"  Title="使用预收金额合计"/>
					<Property Name="SaleInvoiceDTO.OrigTaxAmount"  Title="明细含税金额合计"/>
					<Property Name="SaleInvoiceDTO.idCurrency"  Title="币种ID"/>
					<Property Name="SaleInvoiceDTO.Currency.ID"  Title="币种"/>
					<Property Name="SaleInvoiceDTO.Currency.Name"  Title="币种名称"/>
					<Property Name="SaleInvoiceDTO.ExchangeRate"  Title="汇率"/>
					<Property Name="SaleInvoiceDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleInvoiceDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleInvoiceDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleInvoiceDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleInvoiceDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleInvoiceDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleInvoiceDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleInvoiceDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleInvoiceDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleInvoiceDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleInvoiceDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleInvoiceSettlements" DTO="SaleInvoiceSettlementDTO" FK="idSaleInvoiceDTO" Title="现结明细">
						<Property Name="SaleInvoiceSettlementDTO.ID"  Title="ID"/>
						<Property Name="SaleInvoiceSettlementDTO.TS"  Title="TS"/>
						<Property Name="SaleInvoiceSettlementDTO.idSettleStyle"  Title="结算方式id"/>
						<Property Name="SaleInvoiceSettlementDTO.SettleStyle.ID"  Title="结算方式"/>
						<Property Name="SaleInvoiceSettlementDTO.idBankAccount"  Title="账号id"/>
						<Property Name="SaleInvoiceSettlementDTO.BankAccount.ID"  Title="账号"/>
						<Property Name="SaleInvoiceSettlementDTO.BankAccount.BankNoType.ID"  Title="账号类型id"/>
						<Property Name="SaleInvoiceSettlementDTO.BankAccount.Idcurrency"  Title="账号币种id"/>
						<Property Name="SaleInvoiceSettlementDTO.BillNo"  Title="票据号"/>
						<Property Name="SaleInvoiceSettlementDTO.Amount"  Title="收款金额本币"/>
						<Property Name="SaleInvoiceSettlementDTO.OrigAmount"  Title="收款金额"/>
					</Detail>
					<Detail DetailRuleName="SaleInvoiceDetails" DTO="SaleInvoiceDetailDTO" FK="IdSaleInvoiceDTO" Title="单据明细">
						<Property Name="SaleInvoiceDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleInvoiceDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleInvoiceDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.OrigTaxAmount"  Title="原币含税金额"/>
						<Property Name="SaleInvoiceDetailDTO.TaxAmount"  Title="本币含税金额"/>
						<Property Name="SaleInvoiceDetailDTO.OrigDiscountAmount"  Title="原币金额"/>
						<Property Name="SaleInvoiceDetailDTO.OrigDiscountPrice"  Title="原币单价"/>
						<Property Name="SaleInvoiceDetailDTO.DiscountAmount"  Title="本币金额"/>
						<Property Name="SaleInvoiceDetailDTO.OrigSettleAmount"  Title="本币累计结算金额"/>
						<Property Name="SaleInvoiceDetailDTO.SettleAmount"  Title="原币累计结算金额"/>
						<Property Name="SaleInvoiceDetailDTO.OrigTax"  Title="原币税额"/>
						<Property Name="SaleInvoiceDetailDTO.Tax"  Title="本币税额"/>
						<Property Name="SaleInvoiceDetailDTO.BaseQuantity"  Title="主计量数量"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGenSaleInvoice">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromAr" Name="应收账款" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="OrigTaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="Ar">
							<ExtendRuleProperty Name="idpartnerclass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdPartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>
							<ExtendRuleProperty Name="Iddistrict" SourceVoucherProperty="SaleInvoice.SettleCustomer.Iddistrict" Title="地区"/>
							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="SaleInvoice.Idcurrency" Title="币种"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<TransactionEntry Code="DebitFromCashOrBank" Name="现金、银行存款" DCDirection="Debit">
					<Entry>
						<Property Doc="OrigAmountDr" SourceVoucher="OrigAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="Amount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigAmount" Title="外币"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<Property Doc="BillNo" SourceVoucher="BillNo" Title="票据号"/>
						<Account AccountRuleType="Cash">
							<!--现金-->
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdbankAccount" SourceVoucherProperty="IdbankAccount"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="SaleInvoice.Idcurrency"/>
							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
						<Account AccountRuleType="Bank">
							<!--银行存款-->
							<ExtendRuleProperty Name="IdbankAccount" SourceVoucherProperty="IdbankAccount"/>
							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="SaleInvoice.Idcurrency"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="SaleInvoice.SaleInvoiceDetails.Idwarehouse"/>
						<Property Doc="IdsettleStyle" SourceVoucher="IdsettleStyle"/>
						<Property Doc="idBankAccount" SourceVoucher="IdbankAccount"/>
						<Property Doc="InvoiceCode" SourceVoucher="BillNo"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromSales" Name="主营业务收入" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="OrigDiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<Account AccountRuleType="Sales">
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="Idwarehouse" SourceVoucherProperty="Idwarehouse" Title="仓库"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdPartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
						<Property Doc="Quantity" SourceVoucher="BaseQuantity" Title="数量"/>
						<Property Doc="Price" SourceVoucher="OrigDiscountPrice" Title="单价"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<TransactionEntry Code="DebitFromSalesTax" Name="应交税金（销）"  DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="OrigTax" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="Tax" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTax" Title="外币"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
						<Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<Account AccountRuleType="SalesTax">
							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
		
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdPartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>


							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<TransactionEntry Code="DebitFromAdv" Name="现结+使用预收>明细含税金额合计" DCDirection="Credit">
					<Entry>
						<Property Doc="Idcurrency" SourceVoucher="Idcurrency"/>
						<Property Doc="ExchangeRate" SourceVoucher="ExchangeRate"/>
						<Property Doc="Memoto" SourceVoucher="Memo"/>
						<Account AccountRuleType="AdvReceive">
							<ExtendRuleProperty Name="idbusiType" SourceVoucherProperty="idbusiType"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SettleCustomer.IdpartnerClass"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="IdSettleCustomer"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Iddistrict" SourceVoucherProperty="SettleCustomer.Iddistrict"/>
							<ExtendRuleProperty Name="Idcurrency" SourceVoucherProperty="Idcurrency"/>
							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject"/>
							<ExtendRuleProperty Name="IdProjectClass" SourceVoucherProperty="Project.idclass"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="pubuserdefnvc5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="pubuserdefnvc6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="pubuserdefdecm5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="pubuserdefdecm6"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc0" SourceVoucherProperty="priuserdefnvc1"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc1" SourceVoucherProperty="priuserdefnvc2"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc2" SourceVoucherProperty="priuserdefnvc3"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc3" SourceVoucherProperty="priuserdefnvc4"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc4" SourceVoucherProperty="priuserdefnvc5"/>
							<ExtendRuleProperty Name="Headerpriuserdefnvc5" SourceVoucherProperty="priuserdefnvc6"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm0" SourceVoucherProperty="priuserdefdecm1"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm1" SourceVoucherProperty="priuserdefdecm2"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm2" SourceVoucherProperty="priuserdefdecm3"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm3" SourceVoucherProperty="priuserdefdecm4"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm4" SourceVoucherProperty="priuserdefdecm5"/>
							<ExtendRuleProperty Name="Headerpriuserdefdecm5" SourceVoucherProperty="priuserdefdecm6"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdbankAccount" SourceVoucher="IdbankAccount"/>
						<Property Doc="Idcustomer" SourceVoucher="IdSettleCustomer"/>
						<Property Doc="IdcustomerClass" SourceVoucher="SettleCustomer.IdpartnerClass"/>
						<Property Doc="Iddistrict" SourceVoucher="SettleCustomer.Iddistrict"/>
						<Property Doc="Iddepartment" SourceVoucher="Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="Idperson"/>
						<Property Doc="Idcurrency" SourceVoucher="Idcurrency"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="idbusiType" SourceVoucher="IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="Code"/>
						<Property Doc="VoucherDate" SourceVoucher="VoucherDate"/>
						<Property Doc="IdVoucherType" SourceVoucher="{IdvoucherType}"/>
						<Property Doc="IdIncome" SourceVoucher=""/>
						<Property Doc="IdExpenseItem" SourceVoucher=""/>
						<Property Doc="IdWarehouse" SourceVoucher=""/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>
						<Property Doc="IdDocumentsUsageDTO" SourceVoucher=""/>
						<Property Doc="IdInRdStyle" SourceVoucher=""/>
						<!--<Property Doc="IdSettleStyle" SourceVoucher="IdsettleStyle"/>-->
						<!--<Property Doc="IdDistrict" SourceVoucher="Partner.iddistrict"/>-->
						<!--<Property Doc="IdBankAccount" SourceVoucher="IdbankAccount"/>-->
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBackSaleInvoice" />
		</Voucher>
		<Voucher Code="si_SaleInvoiceFromSaleDispatchDispatchFirst" Name="SaleInvoiceDTO" Title="先出库后开票的发票确认成本(先出库后销货)" IsClosingAccountCarryForward="true">
			<SimpleQuery Name="SaleInvoiceDetailDTO" Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
					<Property Name="VoucherId" MapProperty="SaleInvoice.ID" Title="单据Id"/>
					<Property Name="VoucherTs" MapProperty="SaleInvoice.TS" Title="单据时间戳"/>
					<Property Name="VoucherDetailId" MapProperty="SaleInvoiceDetailDTO.ID" Title="明细Id"/>
					<Property Name="VoucherDetailTs" MapProperty="SaleInvoiceDetailDTO.TS" Title="明细时间戳"/>
					<Property Name="Iddepartment" MapProperty="SaleInvoice.Iddepartment" Title="部门"/>
					<Property Name="Idclerck" MapProperty="SaleInvoice.Idclerk" Title="业务员"/>
					<Property Name="Idproject" MapProperty="SaleInvoiceDetailDTO.Idproject" Title="项目"/>
					<Property Name="IdinventoryClass" MapProperty="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Property Name="Idinventory" MapProperty="SaleInvoiceDetailDTO.IdInventory" Title="存货"/>
					<Property Name="IdbaesUnit" MapProperty="SaleInvoiceDetailDTO.IdbaseUnit" Title="主计量"/>
					<Property Name="VoucherDate" MapProperty="SaleInvoice.VoucherDate" Title="发票日期"/>
					<Property Name="VoucherCode" MapProperty="SaleInvoice.Code" Title="发票号"/>
					<Property Name="ExecutedQuantity" MapProperty="BaseQuantity" Title="数量"/>
					<Property Name="CostPrice" MapProperty="SaleInvoiceDetailDTO.CostPrice" Title="成本单价"/>
					<Property Name="CostAmount" MapProperty="SaleInvoiceDetailDTO.CostAmount" Title="成本金额"/>
				</Fields>
				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleInvoice.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleInvoice.Code" Title="单据编号"/>
					<Filter Name="Departments" MapProperty="SaleInvoice.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleInvoice.Idclerk" Title="员工"/>
					<Filter Name="CustomerCode" MapProperty="SaleInvoice.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleInvoice.SettleCustomer.idPartnerClass" Title="客户分类"/>
					<Filter Name="ProjectClass" MapProperty="SaleInvoiceDetailDTO.Project.IdClass" Title="项目分类"/>
					<Filter Name="Projects" MapProperty="SaleInvoiceDetailDTO.Idproject" Title="项目"/>
					<Filter Name="InventoryCode" MapProperty="SaleInvoiceDetailDTO.Inventory.Code" Title="存货"/>
					<Filter Name="InventoryClasss" MapProperty="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="Bankaccounts" MapProperty="SaleInvoice.SaleInvoiceSettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleInvoice.SaleInvoiceSettlements.IdsettleStyle" Title="结算方式"/>

					<Filter Name="CostPrice" MapProperty="SaleInvoiceDetailDTO.CostPrice" Title="成本单价"/>
					<Filter Name="CostAmount" MapProperty="SaleInvoiceDetailDTO.CostAmount" Title="成本金额"/>
					<Filter Name="maker" MapProperty="SaleInvoice.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleInvoice.auditorid"  Title="审核人"/>
				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="来源于以前期间销售出库单的发票/发票和出库单同一个期间，但出库单在开发票之前生成凭证。">
						Exists
						(
						select SA_SaleInvoice_b.id from SA_SaleInvoice_b
						inner join SA_SaleInvoice on SA_SaleInvoice_b.idSaleInvoiceDTO=SA_SaleInvoice.id
						inner join SA_SaleDelivery_b on SA_SaleInvoice_b.sourceVoucherDetailId=SA_SaleDelivery_b.id
						inner join SA_SaleDelivery on SA_SaleDelivery_b.idSaleDeliveryDTO=SA_SaleDelivery.id
						inner join ST_RDRecord on ST_RDRecord.id=SA_SaleDelivery_b.sourceVoucherId
						left join GL_Doc on st_rdrecord.docid =GL_Doc.id
						where SaleInvoiceDetailDTO.id=SA_SaleInvoice_b.id
						and SA_SaleDelivery_b.idsourcevouchertype='BB007F33-C0F0-4A19-8588-1E0E314D1F56'
						and (
						(st_rdrecord.voucherdate&lt;{StartPeriod} )
						or
						(st_rdrecord.docid is not null and (sa_saleInvoice.CreatedTime > GL_Doc.createdtime or sa_saleInvoice.updated > GL_Doc.createdtime)
						and st_rdrecord.voucherdate between {StartPeriod} and {EndPeriod})
						)
						)
					</Filter>
					<Filter Name="没有期末成本结转过">
						SaleInvoiceDetailDTO.docid is null
					</Filter>
					<Filter Name="存货属性=劳务的不生成">
						SaleInvoiceDetailDTO.Inventory.IsLaborCost=0
					</Filter>
					<Filter Name="未生效的不生成">
						SaleInvoice.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="当前期间内的单据">
						SaleInvoice.voucherdate between {StartPeriod} and {EndPeriod}
					</Filter>
					<Filter Name="选项“未销货的销售出库单”为“处理为发出商品”">
						(select value from EAP_AccInformation where Name='NoSaledDispatchVoucher')=1
					</Filter>
					<Filter Name="发票立账">
						(select value from EAP_AccInformation where Name='SAAccount') = 1
					</Filter>
					<Filter Name="当前期间内的单据">
						SaleInvoice.voucherdate between {StartPeriod} and {EndPeriod}
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleInvoice.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					abs(isnull(SaleInvoiceDetailDTO.CostPrice,0))>0
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuerysi_SaleInvoiceFromSaleDispatchDispatchFirst">
				<Header>
					<Property Name="SaleInvoiceDTO.ID"  Title="单据ID"/>
					<Property Name="SaleInvoiceDTO.TS"  Title="TS"/>
					<Property Name="SaleInvoiceDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleInvoiceDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleInvoiceDTO.Code"  Title="单据编号"/>
					<Property Name="SaleInvoiceDTO.Memo"  Title="备注"/>
					<Property Name="SaleInvoiceDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleInvoiceDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<!--<Property Name="SaleInvoiceDTO.idCurrency"  Title="币种ID"/>
          <Property Name="SaleInvoiceDTO.Currency.ID"  Title="币种"/>
          <Property Name="SaleInvoiceDTO.Currency.Name"  Title="币种名称"/>
          <Property Name="SaleInvoiceDTO.ExchangeRate"  Title="汇率"/>-->
					<Property Name="SaleInvoiceDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleInvoiceDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleInvoiceDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleInvoiceDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleInvoiceDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleInvoiceDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleInvoiceDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleInvoiceDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleInvoiceDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleInvoiceDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleInvoiceDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.IdSourceVoucherType"  Title="来源单据ID"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleInvoiceDetails" DTO="SaleInvoiceDetailDTO" FK="IdSaleInvoiceDTO" Title="单据明细">
						<Property Name="SaleInvoiceDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleInvoiceDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleInvoiceDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.SourceVoucherId"  Title="来源单据ID"/>
						<Property Name="SaleInvoiceDetailDTO.SourceVoucherDetailId"  Title="来源明细ID"/>
						<Property Name="SaleInvoiceDetailDTO.CostPrice"  Title="成本单价"/>
						<Property Name="SaleInvoiceDetailDTO.CostAmount"  Title="成本金额"/>
						<Property Name="SaleInvoiceDetailDTO.BaseQuantity"  Title="主计量数量"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGensi_SaleInvoiceFromSaleDispatchDispatchFirst">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromInventoryPartner" Name="主营业务成本" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="TaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="InventoryPartner">
							<ExtendRuleProperty Name="IdvoucherType" SourceVoucherProperty="{IdSaleDispatchVoucherType}" Title="单据类型"/>
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleInvoice.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="adjusttype" SourceVoucherProperty="{NULL}" Title="调整类型"/>
							<ExtendRuleProperty Name="IdrdStyle" SourceVoucherProperty="{NULL}" Title="出库类别"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							 
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromDeliveryInventory" Name="发出商品" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="DiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<Account AccountRuleType="DeliveryInventory">
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleInvoice.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBacksi_SaleInvoiceFromSaleDispatchDispatchFirst" />
		</Voucher>
		<Voucher Code="si_SaleInvoiceFromSaleDispatchSaleFirst" Name="SaleInvoiceDTO" Title="先出库后开票的发票确认成本(先销货后出库)" IsClosingAccountCarryForward="true">
			<SimpleQuery Name="SaleInvoiceDetailDTO" Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
					<Property Name="VoucherId" MapProperty="SaleInvoice.ID" Title="单据Id"/>
					<Property Name="VoucherTs" MapProperty="SaleInvoice.TS" Title="单据时间戳"/>
					<Property Name="VoucherDetailId" MapProperty="SaleInvoiceDetailDTO.ID" Title="明细Id"/>
					<Property Name="VoucherDetailTs" MapProperty="SaleInvoiceDetailDTO.TS" Title="明细时间戳"/>
					<Property Name="Iddepartment" MapProperty="SaleInvoice.Iddepartment" Title="部门"/>
					<Property Name="Idclerck" MapProperty="SaleInvoice.Idclerk" Title="业务员"/>
					<Property Name="Idproject" MapProperty="SaleInvoiceDetailDTO.Idproject" Title="项目"/>
					<Property Name="IdinventoryClass" MapProperty="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Property Name="Idinventory" MapProperty="SaleInvoiceDetailDTO.IdInventory" Title="存货"/>
					<Property Name="IdbaesUnit" MapProperty="SaleInvoiceDetailDTO.IdbaseUnit" Title="主计量"/>
					<Property Name="VoucherDate" MapProperty="SaleInvoice.VoucherDate" Title="发票日期"/>
					<Property Name="VoucherCode" MapProperty="SaleInvoice.Code" Title="发票号"/>
					<Property Name="ExecutedQuantity" MapProperty="BaseQuantity" Title="数量"/>
					<Property Name="CostPrice" MapProperty="SaleInvoiceDetailDTO.CostPrice" Title="成本单价"/>
					<Property Name="CostAmount" MapProperty="SaleInvoiceDetailDTO.CostAmount" Title="成本金额"/>
				</Fields>
				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleInvoice.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleInvoice.Code" Title="单据编号"/>
					<Filter Name="Departments" MapProperty="SaleInvoice.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleInvoice.Idclerk" Title="员工"/>
					<Filter Name="CustomerCode" MapProperty="SaleInvoice.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleInvoice.SettleCustomer.idPartnerClass" Title="客户分类"/>
					<Filter Name="ProjectClass" MapProperty="SaleInvoiceDetailDTO.Project.IdClass" Title="项目分类"/>
					<Filter Name="Projects" MapProperty="SaleInvoiceDetailDTO.Idproject" Title="项目"/>
					<Filter Name="InventoryCode" MapProperty="SaleInvoiceDetailDTO.Inventory.Code" Title="存货"/>
					<Filter Name="InventoryClasss" MapProperty="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="Bankaccounts" MapProperty="SaleInvoice.SaleInvoiceSettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleInvoice.SaleInvoiceSettlements.IdsettleStyle" Title="结算方式"/>
					<Filter Name="CostPrice" MapProperty="SaleInvoiceDetailDTO.CostPrice" Title="成本单价"/>
					<Filter Name="CostAmount" MapProperty="SaleInvoiceDetailDTO.CostAmount" Title="成本金额"/>
					<Filter Name="maker" MapProperty="SaleInvoice.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleInvoice.auditorid"  Title="审核人"/>
				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="先销货后出库流程的的销售发票and发票期间晚于销货单的所在期间and上期的B=“上期累计开票-上期累计出库”小于0，并且A=”本期开票-本期出库”>0">
						SaleInvoiceDetailDTO.id in(
						select SA_SaleInvoice_b.id from SA_SaleInvoice_b
						left join SA_SaleInvoice on SA_SaleInvoice_b.idSaleInvoiceDTO=SA_SaleInvoice.id
						left join SA_SaleDelivery_b on SA_SaleInvoice_b.sourceVoucherDetailId=SA_SaleDelivery_b.id
						LEFT join(
						--销货单---出库单
						select id,idRDRecordDTO,sourceVoucherDetailId
						from ST_RDRecord_b where idsourcevouchertype IN ('5794D3DD-7FE4-4B5C-AF53-D21DDC13BF16','201720E7-82F9-4C1F-AEA9-0892A121EACD')

						UNION ALL

						--销货单---配送单---出库单
						SELECT idRDRecordDetailDTO as id,ST_RDRecord_b.idRDRecordDTO as idRDRecordDTO,ST_RDRecordSourceRelation.sourceVoucherDetailId
						FROM ST_RDRecordSourceRelation
						left JOIN ST_RDRecord_b on ST_RDRecord_b.id=ST_RDRecordSourceRelation.idRDRecordDetailDTO
						where ST_RDRecord_b.idsourcevouchertype ='3DC12E8A-9243-454A-ADAA-8DC8E1109031'
						)ST_RDRecord_b on SA_SaleDelivery_b.id=ST_RDRecord_b.sourceVoucherDetailId
						left join ST_RDRecord on ST_RDRecord.id=ST_RDRecord_b.idRDRecordDTO
						left join GL_Doc on ST_RDRecord.docid=GL_Doc.id
						where (SA_SaleDelivery_b.idsourcevouchertype&lt;>'BB007F33-C0F0-4A19-8588-1E0E314D1F56' or SA_SaleDelivery_b.idsourcevouchertype is null)--销货单不是来源于出库单先销货后出库
						and ((SA_SaleInvoice.createdtime>GL_Doc.createdtime) or (SA_SaleInvoice.updated>GL_Doc.createdtime) or (ST_RDRecord.voucherdate &lt; {StartPeriod}))--在出库单生成凭证之后新增的发票 或者 单据日期所属期间晚于出库单所属期间的发票
						)
					</Filter>
					<Filter Name="没有期末成本结转过">
						SaleInvoiceDetailDTO.docid is null
					</Filter>
					<Filter Name="未生效的不生成">
						SaleInvoice.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="存货属性=劳务的不生成">
						SaleInvoiceDetailDTO.Inventory.IsLaborCost=0
					</Filter>
					<Filter Name="当前期间内的单据">
						SaleInvoice.voucherdate between {StartPeriod} and {EndPeriod}
					</Filter>
					<Filter Name="选项“未销货的销售出库单”为“处理为发出商品”">
						(select value from EAP_AccInformation where Name='NoSaledDispatchVoucher')=1
					</Filter>
					<Filter Name="发票立账">
						(select value from EAP_AccInformation where Name='SAAccount') = 1
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleInvoice.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					abs(isnull(SaleInvoiceDetailDTO.CostPrice,0))>0
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuerysi_SaleInvoiceFromSaleDispatchSaleFirst">
				<Header>
					<Property Name="SaleInvoiceDTO.ID"  Title="单据ID"/>
					<Property Name="SaleInvoiceDTO.TS"  Title="TS"/>
					<Property Name="SaleInvoiceDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleInvoiceDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleInvoiceDTO.Code"  Title="单据编号"/>
					<Property Name="SaleInvoiceDTO.Memo"  Title="备注"/>
					<Property Name="SaleInvoiceDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleInvoiceDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<!--<Property Name="SaleInvoiceDTO.idCurrency"  Title="币种ID"/>
          <Property Name="SaleInvoiceDTO.Currency.ID"  Title="币种"/>
          <Property Name="SaleInvoiceDTO.Currency.Name"  Title="币种名称"/>
          <Property Name="SaleInvoiceDTO.ExchangeRate"  Title="汇率"/>-->
					<Property Name="SaleInvoiceDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleInvoiceDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleInvoiceDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleInvoiceDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleInvoiceDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleInvoiceDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleInvoiceDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleInvoiceDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleInvoiceDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleInvoiceDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleInvoiceDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.IdSourceVoucherType"  Title="来源单据ID"/>
					<Property Name="SaleInvoiceDTO.updated"  Title="来源单据ID"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleInvoiceDetails" DTO="SaleInvoiceDetailDTO" FK="IdSaleInvoiceDTO" Title="单据明细">
						<Property Name="SaleInvoiceDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleInvoiceDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleInvoiceDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.CostPrice"  Title="成本单价"/>
						<Property Name="SaleInvoiceDetailDTO.CostAmount"  Title="成本金额"/>
						<Property Name="SaleInvoiceDetailDTO.BaseQuantity"  Title="主计量数量"/>
						<Property Name="SaleInvoiceDetailDTO.SourceVoucherId"  Title="来源单据ID"/>
						<Property Name="SaleInvoiceDetailDTO.SourceVoucherDetailId"  Title="来源明细ID"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGensi_SaleInvoiceFromSaleDispatchSaleFirst">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromInventoryPartner" Name="主营业务成本" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="TaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="InventoryPartner">
							<ExtendRuleProperty Name="IdvoucherType" SourceVoucherProperty="{IdSaleDispatchVoucherType}" Title="单据类型"/>
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleInvoice.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="adjusttype" SourceVoucherProperty="{NULL}" Title="调整类型"/>
							<ExtendRuleProperty Name="IdrdStyle" SourceVoucherProperty="{NULL}" Title="出库类别"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromDeliveryInventory" Name="发出商品" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="DiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<Account AccountRuleType="DeliveryInventory">
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleInvoice.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBacksi_SaleInvoiceFromSaleDispatchSaleFirst" />
		</Voucher>
		<Voucher Code="si_CarrryforwardVituralCost" Name="SaleInvoiceDTO" Title="先销货后出库的发票虚拟结转成本" IsClosingAccountCarryForward="true">
			<SimpleQuery Name="SaleInvoiceDetailDTO" Title="简单查询设置" Type="Ufida.T.SM.FC.AbstractSimpleQuery">
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,如果没有某个字段设置为NULL-->
				<!--当前单据到FC_DocSimpleSourceVoucher字段的映射,SELECT部分和WHERE部分都需要配置-->
				<Fields>
					<Property Name="ID" MapProperty="NEWID()" Title="主键" />
					<Property Name="UserId" MapProperty="{UserId}" Title="用户ID" />
					<Property Name="IdvoucherType" MapProperty="{IdvoucherType}" Title="单据类型"/>
					<Property Name="Idcustomer" MapProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
					<Property Name="VoucherId" MapProperty="SaleInvoice.ID" Title="单据Id"/>
					<Property Name="VoucherTs" MapProperty="SaleInvoice.TS" Title="单据时间戳"/>
					<Property Name="VoucherDetailId" MapProperty="SaleInvoiceDetailDTO.ID" Title="明细Id"/>
					<Property Name="VoucherDetailTs" MapProperty="SaleInvoiceDetailDTO.TS" Title="明细时间戳"/>
					<Property Name="Iddepartment" MapProperty="SaleInvoice.Iddepartment" Title="部门"/>
					<Property Name="Idclerck" MapProperty="SaleInvoice.Idclerk" Title="业务员"/>
					<Property Name="Idproject" MapProperty="SaleInvoiceDetailDTO.Idproject" Title="项目"/>
					<Property Name="IdinventoryClass" MapProperty="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Property Name="Idinventory" MapProperty="SaleInvoiceDetailDTO.IdInventory" Title="存货"/>
					<Property Name="IdbaesUnit" MapProperty="SaleInvoiceDetailDTO.IdbaseUnit" Title="主计量"/>
					<Property Name="VoucherDate" MapProperty="SaleInvoice.VoucherDate" Title="发票日期"/>
					<Property Name="VoucherCode" MapProperty="SaleInvoice.Code" Title="发票号"/>
					<Property Name="ExecutedQuantity" MapProperty="BaseQuantity" Title="数量"/>
					<Property Name="CostPrice" MapProperty="SaleInvoiceDetailDTO.CostPrice" Title="成本单价"/>
					<Property Name="CostAmount" MapProperty="SaleInvoiceDetailDTO.CostAmount" Title="成本金额"/>
				</Fields>
				<PropertyFilters>
					<Filter Name="VoucherDate" MapProperty="SaleInvoice.VoucherDate" Title="单据日期"/>
					<Filter Name="VoucherCode" MapProperty="SaleInvoice.Code" Title="单据编号"/>
					<Filter Name="Departments" MapProperty="SaleInvoice.Iddepartment" Title="部门"/>
					<Filter Name="Persons" MapProperty="SaleInvoice.Idclerk" Title="员工"/>
					<Filter Name="CustomerCode" MapProperty="SaleInvoice.SettleCustomer.Code" Title="客户"/>
					<Filter Name="PartnerClass" MapProperty="SaleInvoice.SettleCustomer.idPartnerClass" Title="客户分类"/>
					<Filter Name="Projects" MapProperty="SaleInvoiceDetailDTO.Idproject" Title="项目"/>
					<Filter Name="InventoryCode" MapProperty="SaleInvoiceDetailDTO.Inventory.Code" Title="存货"/>
					<Filter Name="ProjectClass" MapProperty="SaleInvoiceDetailDTO.Project.IdClass" Title="项目分类"/>
					<Filter Name="InventoryClasss" MapProperty="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
					<Filter Name="Bankaccounts" MapProperty="SaleInvoice.SaleInvoiceSettlements.IdbankAccount" Title="账号"/>
					<Filter Name="SettleStyles" MapProperty="SaleInvoice.SaleInvoiceSettlements.IdsettleStyle" Title="结算方式"/>
					<Filter Name="CostPrice" MapProperty="SaleInvoiceDetailDTO.CostPrice" Title="成本单价"/>
					<Filter Name="CostAmount" MapProperty="SaleInvoiceDetailDTO.CostAmount" Title="成本金额"/>
					<Filter Name="maker" MapProperty="SaleInvoice.makerid"  Title="制单人"/>
					<Filter Name="auditor" MapProperty="SaleInvoice.auditorid"  Title="审核人"/>
				</PropertyFilters>

				<!--查询单据的过滤条件，多是不生成凭证过滤条件，也可以添加其他的自定义条件-->
				<BusinessFilters ModeName="PS">
					<Filter Name="先销货后出库流程的的销售发票 and A=“本期开票数量-本期出库数量”>0 and B= “本期累计开票数量-本期累计出库数量” >0">
						Exists(
						select SA_SaleInvoice_b.id from SA_SaleInvoice_b
						inner join SA_SaleDelivery on SA_SaleDelivery.id=SA_SaleInvoice_b.SourceVoucherID
						where SaleInvoiceDetailDTO.id = SA_SaleInvoice_b.id
						and (SA_SaleDelivery.idSourceVoucherType is null or SA_SaleDelivery.idSourceVoucherType&lt;>'BB007F33-C0F0-4A19-8588-1E0E314D1F56')--先销货后出库流程的的销售发票
						and Exists(
						select c.SaleDeliveryDetailID from
						((select SaleDeliveryDetailID from (
						select sourceVoucherDetailId as SaleDeliveryDetailID,SUM(baseQuantity) as InvoiceQuantity,0 as DispatchQuantity
						from SA_SaleInvoice_b
						inner join SA_SaleInvoice on SA_SaleInvoice.id=SA_SaleInvoice_b.idSaleInvoiceDTO
						where SA_SaleInvoice.voucherDate&lt;{EndPeriod}
						group by  sourceVoucherDetailId
						Union All
						select sourceVoucherDetailId as SaleDeliveryDetailID,0 as InvoiceQuantity,SUM(baseQuantity) as DispatchQuantity
						from ST_RDRecord_b
						inner join ST_RDRecord on ST_RDRecord.id=ST_RDRecord_b.idRDRecordDTO
						where ST_RDRecord.voucherDate&lt;{EndPeriod}
						and ST_RDRecord_b.idsourcevouchertype='5794D3DD-7FE4-4B5C-AF53-D21DDC13BF16'--销库单
						group by  sourceVoucherDetailId
						Union All
						--销货单---配送单---出库单
						select ST_RDRecordSourceRelation.sourceVoucherDetailId as SaleDeliveryDetailID,0 as InvoiceQuantity,SUM(baseQuantity) as DispatchQuantity
						from ST_RDRecordSourceRelation
						left join ST_RDRecord on ST_RDRecord.id=ST_RDRecordSourceRelation.voucherid
						where 1=1
						and st_rdrecord.voucherdate&lt;{EndPeriod}
						and ST_RDRecordSourceRelation.idsourcevouchertype='5794D3DD-7FE4-4B5C-AF53-D21DDC13BF16'--来源关系表中的销货单数量
						AND ST_RDRecord.idsourcevouchertype ='3DC12E8A-9243-454A-ADAA-8DC8E1109031'--明细来源于配送单
						GROUP BY sourceVoucherDetailId
						) a
						group by SaleDeliveryDetailID
						having abs(SUM(InvoiceQuantity))>abs(SUM(DispatchQuantity))) c
						inner join
						(select SaleDeliveryDetailID from (
						select sourceVoucherDetailId as SaleDeliveryDetailID,SUM(baseQuantity) as InvoiceQuantity,0 as DispatchQuantity
						from SA_SaleInvoice_b
						inner join SA_SaleInvoice on SA_SaleInvoice.id=SA_SaleInvoice_b.idSaleInvoiceDTO
						where SA_SaleInvoice.voucherDate between {StartPeriod} and {EndPeriod}
						group by  sourceVoucherDetailId
						Union All
						--销货单---出库单
						select sourceVoucherDetailId as SaleDeliveryDetailID,0 as InvoiceQuantity,SUM(baseQuantity) as DispatchQuantity
						from ST_RDRecord_b
						inner join ST_RDRecord on ST_RDRecord.id=ST_RDRecord_b.idRDRecordDTO
						where ST_RDRecord.voucherDate between {StartPeriod} and {EndPeriod}
						and ST_RDRecord_b.idsourcevouchertype='5794D3DD-7FE4-4B5C-AF53-D21DDC13BF16'--销库单
						group by  sourceVoucherDetailId
						Union All
						--销货单---配送单---出库单
						select ST_RDRecordSourceRelation.sourceVoucherDetailId as SaleDeliveryDetailID,0 as InvoiceQuantity,SUM(baseQuantity) as DispatchQuantity
						from ST_RDRecordSourceRelation
						left join ST_RDRecord on ST_RDRecord.id=ST_RDRecordSourceRelation.voucherid
						where 1=1
						and st_rdrecord.voucherdate between '2012-10-01 00:00:00' and '2012-10-31 00:00:00'
						and ST_RDRecordSourceRelation.idsourcevouchertype='5794D3DD-7FE4-4B5C-AF53-D21DDC13BF16'--来源关系表中的销货单数量
						AND ST_RDRecord.idsourcevouchertype ='3DC12E8A-9243-454A-ADAA-8DC8E1109031'--明细来源于配送单
						GROUP BY sourceVoucherDetailId
						) b
						group by SaleDeliveryDetailID
						having abs(SUM(InvoiceQuantity))>abs(SUM(DispatchQuantity))) d
						on c.SaleDeliveryDetailID=d.SaleDeliveryDetailID
						)
						where c.SaleDeliveryDetailID=SA_SaleInvoice_b.sourceVoucherDetailID
						)
						)
					</Filter>
					<Filter Name="没有期末成本结转过">
						SaleInvoiceDetailDTO.docid is null
					</Filter>
					<Filter Name="存货属性=劳务的不生成">
						SaleInvoiceDetailDTO.Inventory.IsLaborCost=0
					</Filter>
					<Filter Name="未生效的不生成">
						SaleInvoice.VoucherState={VoucherState.Effective}
					</Filter>
					<Filter Name="当前期间内的单据">
						SaleInvoice.voucherdate between {StartPeriod} and {EndPeriod}
					</Filter>
					<Filter Name="“未出库的销货单”的选项是“确认收入并结转成本”">
						(select value from EAP_AccInformation where Name='NoDispatchSaleDelivery')=1
					</Filter>
					<Filter Name="发票立账">
						(select value from EAP_AccInformation where Name='SAAccount') = 1
					</Filter>
					<Filter Name="所属营销机构 !=“总部”的单据不生成凭证">
						SaleInvoice.IdmarketingOrgan='4AD74463-E871-4DC1-BEB0-6E6EAA0A6386'
					</Filter>
				</BusinessFilters>
				<IsContainZero Name="明细金额全为0不显示">
					abs(isnull(SaleInvoiceDetailDTO.CostPrice,0))>0
				</IsContainZero>
			</SimpleQuery>
			<FullQuery Name="完整查询设置" Type="Ufida.T.UA.SA.FC.FullQuerysi_CarrryforwardVituralCost">
				<Header>
					<Property Name="SaleInvoiceDTO.ID"  Title="单据ID"/>
					<Property Name="SaleInvoiceDTO.TS"  Title="TS"/>
					<Property Name="SaleInvoiceDTO.IdbusinessType"  Title="业务类型ID"/>
					<Property Name="SaleInvoiceDTO.BusinessType.ID"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.BusinessType.Name"  Title="业务类型"/>
					<Property Name="SaleInvoiceDTO.VoucherDate"  Title="单据日期"/>
					<Property Name="SaleInvoiceDTO.Code"  Title="单据编号"/>
					<Property Name="SaleInvoiceDTO.Memo"  Title="备注"/>
					<Property Name="SaleInvoiceDTO.OrigSettleAmount"  Title="现结金额合计"/>
					<Property Name="SaleInvoiceDTO.SettleAmount"  Title="现结金额（本币）合计"/>
					<!--<Property Name="SaleInvoiceDTO.idCurrency"  Title="币种ID"/>
          <Property Name="SaleInvoiceDTO.Currency.ID"  Title="币种"/>
          <Property Name="SaleInvoiceDTO.Currency.Name"  Title="币种名称"/>
          <Property Name="SaleInvoiceDTO.ExchangeRate"  Title="汇率"/>-->
					<Property Name="SaleInvoiceDTO.idDepartment"  Title="部门ID"/>
					<Property Name="SaleInvoiceDTO.Department.ID"  Title="部门"/>
					<Property Name="SaleInvoiceDTO.Department.Code"  Title="部门编码"/>
					<Property Name="SaleInvoiceDTO.Department.Name"  Title="部门名称"/>
					<Property Name="SaleInvoiceDTO.idClerk"  Title="人员ID"/>
					<Property Name="SaleInvoiceDTO.Clerk.ID"  Title="人员"/>
					<Property Name="SaleInvoiceDTO.Clerk.Code"  Title="人员编码"/>
					<Property Name="SaleInvoiceDTO.Clerk.Name"  Title="人员名称"/>
					<Property Name="SaleInvoiceDTO.idSettleCustomer"  Title="客户ID"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.ID"  Title="客户"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Code"  Title="客户编码"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Name"  Title="客户名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.IdpartnerClass"  Title="往来单位分类id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.ID"  Title="往来单位分类"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.PartnerClass.Name"  Title="往来单位名称"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.Iddistrict"  Title="地区id"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.ID"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Name"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.SettleCustomer.District.Code"  Title="地区"/>
					<Property Name="SaleInvoiceDTO.idProject"  Title="项目ID"/>
					<Property Name="SaleInvoiceDTO.Project.ID"  Title="项目"/>
					<Property Name="SaleInvoiceDTO.Project.Name"  Title="项目名称"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc1"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc2"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc3"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc4"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc5"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefnvc6"  Title="单据专用字符自定义字符项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm1"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm2"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm3"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm4"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm5"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.pubuserdefdecm6"  Title="单据公用字符自定义数值项"/>
					<Property Name="SaleInvoiceDTO.IdSourceVoucherType"  Title="来源单据ID"/>
				</Header>
				<Details>
					<Detail DetailRuleName="SaleInvoiceDetails" DTO="SaleInvoiceDetailDTO" FK="IdSaleInvoiceDTO" Title="单据明细">
						<Property Name="SaleInvoiceDetailDTO.ID"  Title="ID"/>
						<Property Name="SaleInvoiceDetailDTO.TS"  Title="TS"/>
						<Property Name="SaleInvoiceDetailDTO.Idwarehouse"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.ID"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Name"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.Warehouse.Code"  Title="仓库"/>
						<Property Name="SaleInvoiceDetailDTO.IdProject"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.ID"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Name"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Code"  Title="项目"/>
						<Property Name="SaleInvoiceDetailDTO.Project.IdClass"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.ID"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Name"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.Project.Class.Code"  Title="项目分类"/>
						<Property Name="SaleInvoiceDetailDTO.IdInventory"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.ID"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Name"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.Code"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IsLaborCost"  Title="存货"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.IdinventoryClass" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.ID" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Code" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.InventoryClass.Name" Title="存货分类"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc1"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc2"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc3"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc4"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.Inventory.priuserdefnvc5"  Title="存货字符自定义项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc1"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc2"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc3"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefnvc4"  Title="明细专用字符自定义字符项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm1"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm2"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm3"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.pubuserdefdecm4"  Title="明细公用字符自定义数值项"/>
						<Property Name="SaleInvoiceDetailDTO.SourceVoucherId"  Title="来源单据ID"/>
						<Property Name="SaleInvoiceDetailDTO.SourceVoucherDetailId"  Title="来源明细ID"/>
						<Property Name="SaleInvoiceDetailDTO.CostPrice"  Title="成本单价"/>
						<Property Name="SaleInvoiceDetailDTO.CostAmount"  Title="成本金额"/>
						<Property Name="SaleInvoiceDetailDTO.BaseQuantity"  Title="主计量数量"/>
					</Detail>
				</Details>
			</FullQuery>
			<TransactionDoc Type="Ufida.T.UA.SA.FC.DocGensi_CarrryforwardVituralCost">
				<SummaryFields>
					<Property Name="VoucherTypeId" Mapping="{IdvoucherType}" Title="单据类型ID"/>
					<Property Name="BusiTypeId" Mapping="IdbusinessType" Title="业务类型ID"/>
					<Property Name="BusiType" Mapping="BusinessType.Name" Title="业务类型"/>
					<Property Name="PartnerClass" Mapping="SettleCustomer.PartnerClass.Name" Title="往来单位"/>
					<Property Name="Partner" Mapping="SettleCustomer.Name" Title="往来单位"/>
					<Property Name="Department" Mapping="Department.Name" Title="部门"/>
					<Property Name="Person" Mapping="Clerk.Name" Title="人员"/>
					<Property Name="Memo" Mapping="Memo" Title="备注"/>
				</SummaryFields>
				<!--借方开始-->
				<TransactionEntry Code="DebitFromInventoryPartner" Name="主营业务成本" DCDirection="Debit">
					<Entry>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Property Doc="OrigAmountDr" SourceVoucher="TaxAmount" Title="借方原币"/>
						<Property Doc="AmountDr" SourceVoucher="TaxAmount" Title="借方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigTaxAmount" Title="外币"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<!--这段配置了没用处，需要倒挤，在代码里面算-->
						<Account AccountRuleType="InventoryPartner">
							<ExtendRuleProperty Name="IdvoucherType" SourceVoucherProperty="{IdSaleDispatchVoucherType}" Title="单据类型"/>
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleInvoice.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="adjusttype" SourceVoucherProperty="{NULL}" Title="调整类型"/>
							<ExtendRuleProperty Name="IdrdStyle" SourceVoucherProperty="{NULL}" Title="出库类别"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--借方结束-->
				<!--贷方开始-->
				<TransactionEntry Code="DebitFromDeliveryInventory" Name="发出商品" DCDirection="Credit">
					<Entry>
						<Property Doc="OrigAmountCr" SourceVoucher="DiscountAmount" Title="贷方原币"/>
						<Property Doc="AmountCr" SourceVoucher="DiscountAmount" Title="贷方本币"/>
						<Property Doc="OrigAmount" SourceVoucher="OrigDiscountAmount" Title="外币"/>
						<Property Doc="QuantityCr" SourceVoucher="BaseQuantity" Title="贷方数量"/>
						<!--<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency" Title="币种"/>
            <Property Doc="ExchangeRate" SourceVoucher="SaleInvoice.ExchangeRate" Title="汇率"/>-->
						<Property Doc="Memoto" SourceVoucher="SaleInvoice.Memo" Title="备注"/>
						<Account AccountRuleType="DeliveryInventory">
							<ExtendRuleProperty Name="IdbusiType" SourceVoucherProperty="SaleInvoice.IdbusinessType" Title="业务类型"/>
							<ExtendRuleProperty Name="Idinventory" SourceVoucherProperty="Idinventory" Title="存货"/>
							<ExtendRuleProperty Name="IdinventoryClass" SourceVoucherProperty="Inventory.IdinventoryClass" Title="存货分类"/>
							<ExtendRuleProperty Name="IdpartnerClass" SourceVoucherProperty="SaleInvoice.SettleCustomer.IdpartnerClass" Title="客户分类"/>
							<ExtendRuleProperty Name="Idpartner" SourceVoucherProperty="SaleInvoice.IdSettleCustomer" Title="客户"/>
							<ExtendRuleProperty Name="IdDepartment" SourceVoucherProperty="SaleInvoice.Iddepartment" Title="部门"/>
 							<ExtendRuleProperty Name="IdClerk" SourceVoucherProperty="SaleInvoice.IdClerk"/>

							<ExtendRuleProperty Name="Idproject" SourceVoucherProperty="Idproject" Title="项目"/>

							<ExtendRuleProperty Name="IsLaborCost" SourceVoucherProperty="Inventory.IsLaborCost" Title="存货属性"/>
							<ExtendRuleProperty Name="IdprojectClass" SourceVoucherProperty="Project.IdClass" Title="项目分类"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc0" SourceVoucherProperty="SaleInvoice.pubuserdefnvc1" Title="表头公共自定义字符项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc1" SourceVoucherProperty="SaleInvoice.pubuserdefnvc2" Title="表头公共自定义字符项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc2" SourceVoucherProperty="SaleInvoice.pubuserdefnvc3" Title="表头公共自定义字符项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc3" SourceVoucherProperty="SaleInvoice.pubuserdefnvc4" Title="表头公共自定义字符项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc4" SourceVoucherProperty="SaleInvoice.pubuserdefnvc5" Title="表头公共自定义字符项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefnvc5" SourceVoucherProperty="SaleInvoice.pubuserdefnvc6" Title="表头公共自定义字符项6"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm0" SourceVoucherProperty="SaleInvoice.pubuserdefdecm1" Title="表头公共自定义数值项1"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm1" SourceVoucherProperty="SaleInvoice.pubuserdefdecm2" Title="表头公共自定义数值项2"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm2" SourceVoucherProperty="SaleInvoice.pubuserdefdecm3" Title="表头公共自定义数值项3"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm3" SourceVoucherProperty="SaleInvoice.pubuserdefdecm4" Title="表头公共自定义数值项4"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm4" SourceVoucherProperty="SaleInvoice.pubuserdefdecm5" Title="表头公共自定义数值项5"/>
							<ExtendRuleProperty Name="Headerpubuserdefdecm5" SourceVoucherProperty="SaleInvoice.pubuserdefdecm6" Title="表头公共自定义数值项6"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc0" SourceVoucherProperty="pubuserdefnvc1" Title="表体公共自定义字符项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc1" SourceVoucherProperty="pubuserdefnvc2" Title="表体公共自定义字符项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc2" SourceVoucherProperty="pubuserdefnvc3" Title="表体公共自定义字符项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefnvc3" SourceVoucherProperty="pubuserdefnvc4" Title="表体公共自定义字符项4"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm0" SourceVoucherProperty="pubuserdefdecm1" Title="表体公共自定义数值项1"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm1" SourceVoucherProperty="pubuserdefdecm2" Title="表体公共自定义数值项2"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm2" SourceVoucherProperty="pubuserdefdecm3" Title="表体公共自定义数值项3"/>
							<ExtendRuleProperty Name="Detailspubuserdefdecm3" SourceVoucherProperty="pubuserdefdecm4" Title="表体公共自定义数值项4"/>
						</Account>
					</Entry>
					<Auxiliary>
						<Property Doc="IdprojectClass" SourceVoucher="Project.IdClass" Title="项目分类"/>
						<Property Doc="Iddepartment" SourceVoucher="SaleInvoice.Iddepartment"/>
						<Property Doc="Idperson" SourceVoucher="SaleInvoice.IdClerk"/>
						<Property Doc="Idcurrency" SourceVoucher="SaleInvoice.Idcurrency"/>
						<Property Doc="idbusiType" SourceVoucher="SaleInvoice.IdbusinessType"/>
						<Property Doc="VoucherCode" SourceVoucher="SaleInvoice.Code"/>
						<Property Doc="VoucherDate" SourceVoucher="SaleInvoice.VoucherDate"/>
						<Property Doc="IdvoucherType" SourceVoucher="{IdvoucherType}" Title="单据类型"/>
						<Property Doc="Idproject" SourceVoucher="Idproject"/>
						<Property Doc="Idinventory" SourceVoucher="Idinventory"/>
						<Property Doc="IdUnit" SourceVoucher="IdUnit" Title="计量单位"/>
						<Property Doc="IdinventoryClass" SourceVoucher="Inventory.IdinventoryClass"/>

						<Property Doc="IdcustomerClass" SourceVoucher="SaleInvoice.SettleCustomer.IdpartnerClass"/>
						<Property Doc="Idcustomer" SourceVoucher="SaleInvoice.IdSettleCustomer"/>
						<Property Doc="Iddistrict" SourceVoucher="SaleInvoice.SettleCustomer.Iddistrict"/>
						<Property Doc="Idwarehouse" SourceVoucher="Idwarehouse"/>
					</Auxiliary>
					<SourceRelation>
						<Property Doc="SourceVoucherId" SourceVoucher="SaleInvoice.ID"/>
						<Property Doc="SourceVoucherTs" SourceVoucher="SaleInvoice.Ts"/>
						<Property Doc="SourceVoucherDetailId" SourceVoucher="ID"/>
						<Property Doc="SourceVoucherDetailTs" SourceVoucher="Ts"/>
					</SourceRelation>
				</TransactionEntry>
				<!--贷方结束-->
			</TransactionDoc>
			<DocUpdateBack Title="回写" Type="Ufida.T.UA.SA.FC.DocUpdateBacksi_CarrryforwardVituralCost" />
		</Voucher>
	</Modle>
</DocSourceVoucher>
